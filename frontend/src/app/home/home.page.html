<ion-header>
  <ion-toolbar>
    <ion-title>Market Data Viewer</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-button expand="full" (click)="fetchMarketData()"
    >Fetch Market Data</ion-button
  >
  <ion-button
    expand="full"
    (click)="nextBar()"
    [disabled]="currentIndex >= marketData.length - 1"
    >Next Bar</ion-button
  >

  <div *ngIf="currentIndex >= 0">
    <h2>Current Bar</h2>
    <p>
      {{ marketData[currentIndex].time }} - Open: {{
      marketData[currentIndex].open }}, High: {{ marketData[currentIndex].high
      }}, Low: {{ marketData[currentIndex].low }}, Close: {{
      marketData[currentIndex].close }}
    </p>

    <ion-button
      color="success"
      expand="full"
      (click)="enterLong()"
      [disabled]="position !== PositionState.None"
      >Go Long</ion-button
    >

    <ion-button
      color="danger"
      expand="full"
      (click)="enterShort()"
      [disabled]="position !== PositionState.None"
      >Go Short</ion-button
    >

    <ion-button
      expand="full"
      (click)="exitPosition()"
      [disabled]="position === PositionState.None"
      >Exit Position</ion-button
    >

    <div *ngIf="position !== PositionState.None">
      <h3>
        Position: {{ position === PositionState.Long ? 'Long' : 'Short' }}
      </h3>
      <p>Entry Price: {{ entryPrice }}</p>
      <p>Current P&L: {{ pnl | number:'1.2-2' }}</p>
    </div>
  </div>

  <div *ngIf="marketData.length === 0">
    <p>No data available. Please click the button to fetch data.</p>
  </div>
</ion-content>
